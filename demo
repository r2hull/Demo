Multi-Account Settlement&Refund for SBIePay 2.0

OBJECTIVE
Currently SBIePay settles transaction amount to merchants in multi-account settlement 
format only in the 1.0 environment.
The objective of this document is to illustrate the process of multi-account settlement and 
multi-account refund in the 2.0 environment.
SCOPE
In scope:
Merchant Panel
Transaction flow
Reconciliation
Settlement
Payout
Refund
Addback
Ekuber reporting
CURRENT PROCESS
Currently SBIePay settles transaction amount to merchants in multi-account settlement format 
only in the 1.0 environment.
However, ‘refund against settlement’ can only be initiated via a single primary settlement 
account.
PROPOSED SOLUTION
Merchant Panel
User can add merchant settlement bank account in the below tool: -
Bank Account -> Bank Account Details -> ‘Add Bank Account’ button.
User can also click on ‘Edit button’ in Modify column.
Here a new column will be introduced indicating – ‘Treasury Account’ and ‘Non-Treasury 
Account’.
Also rename unique identifier to ‘Unique Identifier/ Account Head*’
Adding the merchant multi-account in the above tool: -
Add ‘account heads’, ‘account numbers’ in the above ‘Bank Account’ tool.
Transaction Flow
Merchant will pass transaction packet which will flow from merchant side to SBIePay side.
Merchant will also pass ‘Other Details’ in transaction packet.
When transaction takes place, it is mandatory for the merchant to share Account heads in 
'Other Details'.
Each Account Head represents a different account number associated with the merchant.
Example → 
"multiAccounts" :
[
{
"accountIdentifier": "Audi",
"amount": 1
},
{
"accountIdentifier": "NEFT",
"amount": 1
}
]
Example →
Merchant Order Amount → Rs. 1000
"multiAccounts" :
[
{
"accountIdentifier": "0055",
"amount": 500
},
{
"accountIdentifier": "0022",
"amount": 300
},
{
"accountIdentifier": "0051",
"amount": 200
}
]
Here 0055, 0051 and 0022 represent account heads.
Transaction validations required: Amount of all 'account heads' should add up to total order
amount.
Multi-Account Settlement Process
Behind every account head an account number is mapped.
Each of these accounts is a settlement account number. As per above example merchant order amount is Rs. 1000 out of which Rs. 500, Rs. 300 and Rs. 200 will be settled in the three
accounts respectively. One of the account numbers will be a primary account number.
Once transaction is complete on T day, reconciliation and settlement will be carried out on 
T+1 day.
Reconciliation amount will be credited by channels in SBIePay pooling account.
During settlement process SBIePay will debit pooling account and credit in registered Merchant settlement account number.
Since merchant is following a multi-account settlement model, settlement amount will be credited in the different accounts.
Settlement in respective multiple account heads basis unique identifier provided in Request 
string.
Out of all the multi-accounts, only one account will be a primary account and the remaining 
will be secondary accounts.
During order creation process, certain checks will be carried out by SBIePay system:-
• Condition1 - System will check if ‘multi-account settlement’ flag is present for a given 
merchant.
• Condition2 - System will check if the respective account heads which is passed by 
merchant is configured in SBIePay system.
• Condition3 - The sum of amounts in account heads has to match the total amount. 
If either of the cases fail, then system will show error when ‘multiAccount’ parameter is 
passed during transaction.
Error Code Error Messages Condition
2002 Request Parameter is invalid. Reason : 
Multi Account is not enabled.
Condition1
2002 Multi Account is invalid. Reason : MultiAccount identifier details are invalid.
Condition2
2002 Multi Account Total Amount is invalid. 
Reason : Order amount and multiAccount amount mismatch.
Condition3
SBIePay Payout Process
A scheduled process runs in the SBIePay system which initiates the payout process.
Once payout is completed, Nodal file (trickle feed file) will be generated.
Merchant payout to be generated “Account wise (Basis Unique Identifier)”.
The trickle feed file to contain debit and credit records.
Debit from SBIePay Nodal account and Credit to merchant settlement account.
The trickle feed file to show ‘AAT’ in the trickle narration if the beneficiary merchant account is 
in SBI.
The trickle feed file to show ‘NEFT’ in the trickle narration if the beneficiary merchant account 
is outside SBI.
Multi-Account Refund Process
For a given merchant refund will be carried out via ‘refund against settlement’ model.
There can be two types of refund: -
1. DVP refund
2. Merchant initiated refund
The underlying process is applicable only to ‘merchant initiated refund’.
The change is applicable on ‘full refund’ as well as ‘partial refund’ cases.
Merchant will raise refund via refund tool.
SBIePay will process the refund request and prepare the refund file.
Refund will have to be adjusted from the respective settlement accounts.
Below validations will be carried out by SBIePay before the refund amount to be adjusted 
from next settlement cycle of SBIePay for the given merchant.
a. The respective settlement accounts must have adequate amount before refund amount 
is adjusted from the account number as per the settlement.
b. The account number (Sub a/c) with No or negative balance will be adjusted from the 
primary a/c.
c. In-case the primary a/c also doesn't have enough balance then the merchant will be 
marked as "Negative"
Note: - The option to be explored for restricting the "Refund Booking" - if the Sub (1st) 
/ Primary (2nd) a/c's doesn't have enough balance - Evading the negative balance in 
system.
We will try to understand different refund scenarios via below example →
During transaction → Order amount = Rs. 1000
Other Details →
"multiAccounts" :
[
{
"accountIdentifier": "0055",
"amount": 500
},
{
"accountIdentifier": "0022",
"amount": 300
},
{
"accountIdentifier": "0051",
"amount": 200
}
]
0055 – account head of primary account.
0022 – account head of secondary account.
0051 – account head of secondary account.
➢ On T+1 day, all channels have sent recon files to SBIePay along with the transaction 
amount.
➢ Now SBIePay will settle Rs. 1000 in merchant settlement account.
➢ Before settlement takes place, the below validation will be made: -
➢ If there is any case of merchant initiated refund, it will be adjusted from the respective 
multi-accounts.
eKuber functionality changes
➢ If the merchant has any settlement account which is a treasury account, then the settlement amount audit is carried out by RBI.
➢ Hence, once settlement is done, special excel reports will be created and shared to 
GBSS (SP1) team.
➢ Further GBSS team will prepare eKuber files basis those reports and share it further 
with RBI.
➢ For development of eKuber, please refer eKuber 2.0 product note.
Refund tool
Whatever refund needs to be processed on a given day, it totally depends on the 
reconciliation amount available with SBIePay on that given day.
The below existing tool will be used on Merchant Panel: -
• User will login in merchant panel.
• User will navigate and open right panel.
• User will click on Book Refund.
• User will navigate to below section to book multi-account refund.
• User can see the list of multi-accounts mapped against a particular merchant.
• Only one account will be primary account and remaining accounts will be secondary 
accounts.
• The user will be able to see the masked account number and also understand which is 
the primary account of all from the column ‘Primary/ Secondary beneficiary account’.
• User will be able to see the Account heads against every account number.
• User will also be able to see the amount settled by SBIePay to merchant previously in 
all the accounts against the particular transaction.
• The user can also see the available reconciliation amount for a given day.
• The user can enter the required ‘Refund amount’ against every account.
Conditions that will follow: -
• Refund amount can either be equal to or less that the available reconciliation amount 
for the day.
• Refund amount can either be equal to or less that ‘Already settled amount against 
particular transaction’. A user can only raise refund as much as already settled for a 
particular transaction.
• If available balance is not sufficient, then merchant will have to select multiple 
accounts.
• If the amount is added in different secondary accounts to adjust the refund, however 
there is still some refund amount pending, then by default he will have to select 
‘Primary account’. Without that he will not be able to ‘Preview’ and further book refund.
• If any of the refunds are not getting adjusted the entire refund request cannot be 
processed.
• Also once refund is raised, separate (multiple) ARRNs will be generated against every 
adjustment of refund against the primary or secondary accounts.
UI level features for multi-account refund
• User will only be able to see ‘Primary/Secondary beneficiary account’, ‘Account 
number’ and ‘Account head’ columns when the right panel is opened. The entire refund 
block (new section which is to be developed) will be scrollable (horizontally and 
vertically) inside the right panel.
• Also, it can be scrolled via touch if feature given on mobile in future.
Bulk refund
For any given merchant bulk refund will be raised. However, the data will be filled using a 
report.
New addition of columns in the Bulk refund report.
For a given merchant say there are ‘n’ number of account heads, the sample report will 
contain the x number of columns and will be seen as below excel image. 
Refund will be processed as is.
An additional column showing account head will also be present.
Example – a merchant has 3 account heads. The bulk upload refund report will contain three 
additional columns. 
The account head identifier will be the header of the column name and the respective amount 
can be entered.
APIs affected for Refund module
Refund API
Refund search API
Merchant panel booking API
Enquiry of refund inside merchant panel
Bulk refund
Reports affected
Mass report (multi-acount settlement report)
Head wise payment report
Particular account report
Addback
Add-Back functionality changes - This would be introduced while designing admin (SBIePay 
1.0 - to be referred).
ANNEXURE
NA
ASSUMPTIONS
If 
OPEN POINTS
NA
