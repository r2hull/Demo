@Repository
public interface ListOfValueRepository extends JpaRepository<ListOfValue, UUID> {

    // get all values for given master id
    List<ListOfValue> findByMasterIdAndActive(UUID masterId, long active);

    // get all values for given parent id (dependent dropdown)
    List<ListOfValue> findByParentIdAndActive(UUID parentId, long active);

}




@Service
@RequiredArgsConstructor
@Slf4j
public class MasterDataService {

    private final ListOfMasterRepository masterRepo;
    private final ListOfValueRepository valueRepo;

    public List<ListOfValue> getMasterValues(String alias, UUID parentId) {

        if (parentId != null) {
            // dependent data (like state, city)
            log.info("Fetching values for parentId: {}", parentId);
            return valueRepo.findByParentIdAndActive(parentId, 1L);
        }

        if (alias != null && !alias.isBlank()) {
            log.info("Fetching master by alias: {}", alias);
            Optional<ListOfMaster> masterOpt = masterRepo.findByMasterNameIgnoreCase(alias);
            if (masterOpt.isEmpty()) {
                throw new RuntimeException("Invalid master alias");
            }
            return valueRepo.findByMasterIdAndActive(masterOpt.get().getId(), 1L);
        }

        throw new RuntimeException("Either alias or parentId must be provided");
    }
}



@RestController
@RequestMapping("/api/master-values")
@RequiredArgsConstructor
public class MasterDataController {

    private final MasterDataService masterDataService;

    @GetMapping
    public ResponseEntity<?> getMasterValues(
            @RequestParam(required = false) String alias,
            @RequestParam(required = false) UUID parentId) {

        try {
            List<ListOfValue> values = masterDataService.getMasterValues(alias, parentId);
            Map<String, Object> response = new HashMap<>();
            response.put("status", 1);
            response.put("data", values);
            return ResponseEntity.ok(response);

        } catch (RuntimeException e) {
            Map<String, Object> error = new HashMap<>();
            error.put("status", 0);
            error.put("errors", List.of(Map.of(
                    "errorCode", "MASTER_FETCH_ERROR",
                    "errorMessage", e.getMessage()
            )));
            return ResponseEntity.badRequest().body(error);
        }
    }
}




@Repository
public interface ListOfMasterRepository extends JpaRepository<ListOfMaster, UUID> {
    Optional<ListOfMaster> findByMasterNameIgnoreCase(String masterName);
}