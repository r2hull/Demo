for (MultiAccountDto req : multiAccount) {
    String reqHeader = req.getAccountIdentifier();
    BigDecimal reqAmount = req.getAmount();

    MerchantOrderAccountInfoDto match = accountInfoWithUnsettled.stream()
            .filter(db -> db.getAccountHeader() != null 
                       && db.getAccountHeader().equals(reqHeader))
            .findFirst()
            .orElseThrow(() -> new IllegalArgumentException(
                    "No account found for header: " + reqHeader));

    if (reqAmount.compareTo(match.getUnsettledAmount()) > 0) {
        throw new IllegalArgumentException(
                String.format("Requested amount %s exceeds unsettled amount %s for header '%s'",
                        reqAmount, match.getUnsettledAmount(), reqHeader));
    }
}