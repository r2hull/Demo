private MimeMultipart rewriteBoundary(MimeMultipart multipart, String fixedBoundary) throws IOException, MessagingException {
    ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
    multipart.writeTo(outputStream);

    // Convert MIME content to a string
    String originalContent = outputStream.toString(StandardCharsets.UTF_8);

    // Extract all boundaries present in the content
    String boundaryPattern = "boundary=\"?([^\"\\s]+)\"?"; // Matches boundary="..."
    Pattern pattern = Pattern.compile(boundaryPattern);
    Matcher matcher = pattern.matcher(multipart.getContentType());

    List<String> existingBoundaries = new ArrayList<>();
    while (matcher.find()) {
        existingBoundaries.add(matcher.group(1)); // Extract existing boundaries
    }

    if (existingBoundaries.isEmpty()) {
        throw new MessagingException("No boundary found in content type!");
    }

    // Replace all occurrences of dynamically generated boundaries with the fixed one
    String modifiedContent = originalContent;
    for (String originalBoundary : existingBoundaries) {
        modifiedContent = modifiedContent.replaceAll(Pattern.quote(originalBoundary), fixedBoundary);
    }

    // Ensure the new boundary starts with "--"
    String finalBoundary = "--" + fixedBoundary;

    // Wrap modified content back into a MimeMultipart
    ByteArrayDataSource byteArrayDataSource = new ByteArrayDataSource(
            modifiedContent.getBytes(StandardCharsets.UTF_8),
            "multipart/mixed; boundary=" + finalBoundary
    );

    return new MimeMultipart(byteArrayDataSource);
}