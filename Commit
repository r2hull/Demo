public static byte[] generateAudioCaptcha(String text, UUID requestId) {
    File tempFile = createTempFile(requestId);
    if (tempFile == null) return new byte[0];

    try {
        Voice voice = initializeVoice();
        if (voice == null) return new byte[0];

        SingleFileAudioPlayer audioPlayer = configureAudioPlayer(tempFile);
        voice.setAudioPlayer(audioPlayer);

        speakCharacters(voice, text);
        cleanupResources(voice, audioPlayer);

        return validateAndReturnAudio(tempFile, requestId);
    } catch (Exception e) {
        logger.error("Error generating speech audio for requestId: {}", requestId, e);
        throw new MerchantException(ErrorConstants.GENERATION_ERROR_CODE,
                MessageFormat.format(ErrorConstants.GENERATION_ERROR_MESSAGE, requestId));
    } finally {
        deleteTempFile(tempFile);
    }
}

private static File createTempFile(UUID requestId) {
    try {
        File tempFile = File.createTempFile("speech_" + System.currentTimeMillis() + "_" + requestId, ".wav");
        tempFile.deleteOnExit();
        return tempFile;
    } catch (IOException e) {
        logger.error("Failed to create temp file for requestId: {}", requestId, e);
        return null;
    }
}

private static Voice initializeVoice() {
    Voice voice = VoiceManager.getInstance().getVoice(VOICE_NAME);
    if (voice == null) {
        logger.error("Voice '{}' not found.", VOICE_NAME);
        return null;
    }
    voice.allocate();
    voice.setRate(130);
    voice.setPitch(100);
    voice.setVolume(1.0f);
    return voice;
}

private static SingleFileAudioPlayer configureAudioPlayer(File tempFile) {
    return new SingleFileAudioPlayer(tempFile.getAbsolutePath().replace(".wav", ""), AudioFileFormat.Type.WAVE);
}

private static void speakCharacters(Voice voice, String text) {
    text.chars()
        .mapToObj(c -> String.valueOf((char) c))
        .filter(ch -> ch.matches("[a-zA-Z0-9]"))
        .forEach(ch -> {
            voice.speak(ch);
            sleep(10);
        });
}

private static void cleanupResources(Voice voice, SingleFileAudioPlayer audioPlayer) {
    voice.deallocate();
    audioPlayer.close();
}

private static byte[] validateAndReturnAudio(File tempFile, UUID requestId) {
    if (!tempFile.exists() || tempFile.length() == 0) {
        logger.error("Generated audio file is empty or missing for requestId: {}", requestId);
        return new byte[0];
    }
    return fileToByteArray(tempFile);
}

private static void deleteTempFile(File tempFile) {
    if (tempFile != null && tempFile.exists() && !tempFile.delete()) {
        logger.warn("Failed to delete temporary file: {}", tempFile.getAbsolutePath());
    }
}

private static void sleep(long millis) {
    try {
        Thread.sleep(millis);
    } catch (InterruptedException e) {
        Thread.currentThread().interrupt();
    }
}