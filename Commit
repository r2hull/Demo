@Component
public class CustomReader implements ItemReader<ReportScheduleManagement> {

    @Autowired
    private ReportingConfig reportingConfig;

    @Autowired
    private ReportScheduleManagementRepository reportScheduleManagementRepository;

    private List<ReportScheduleManagement> reportList;
    private int nextIndex = 0;

    @Override
    public ReportScheduleManagement read() {
        // Load data only once
        if (reportList == null) {
            Long scheduleStartTime = DateTimeUtils.getCurrentTimeInMills();
            Long scheduleEndTime = DateTimeUtils.addMinutes(reportingConfig.getReportScheduleExecutionWindow());

            reportList = reportScheduleManagementRepository.findByStatusAndNextScheduleExecutionTime(
                    ReportScheduledStatus.TO_BE_START, scheduleStartTime, scheduleEndTime
            );
        }

        // Return one item at a time
        if (nextIndex < reportList.size()) {
            return reportList.get(nextIndex++);
        } else {
            return null; // No more data, signals end of batch
        }
    }
}