private MimeMultipart rewriteBoundary(MimeMultipart multipart, String fixedBoundary) throws IOException, MessagingException {
    ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
    multipart.writeTo(outputStream);

    // Convert MIME content to a string
    String originalContent = outputStream.toString(StandardCharsets.UTF_8);

    // Extract the existing boundary using regex
    String boundaryPattern = "boundary=\"?([^\"\\s]+)\"?"; // Matches boundary="..."
    Pattern pattern = Pattern.compile(boundaryPattern);
    Matcher matcher = pattern.matcher(multipart.getContentType());

    if (!matcher.find()) {
        throw new MessagingException("Original boundary not found in content type!");
    }

    String originalBoundary = matcher.group(1); // Extracts the existing boundary

    // Replace all occurrences of the original boundary with the fixed boundary
    String modifiedContent = originalContent.replaceAll(Pattern.quote(originalBoundary), fixedBoundary);

    // Ensure the new boundary starts with "--"
    String finalBoundary = "--" + fixedBoundary;

    // Wrap modified content back into a MimeMultipart
    ByteArrayDataSource byteArrayDataSource = new ByteArrayDataSource(
            modifiedContent.getBytes(StandardCharsets.UTF_8),
            "multipart/mixed; boundary=" + finalBoundary
    );

    return new MimeMultipart(byteArrayDataSource);
}