import com.sun.speech.freetts.Voice;
import com.sun.speech.freetts.VoiceManager;
import java.util.stream.IntStream;

public class TalkResource {
    private static final String VOICENAME_KEVIN = "kevin16";

    public void speak(String text) {
        VoiceManager voiceManager = VoiceManager.getInstance();
        Voice voice = voiceManager.getVoice(VOICENAME_KEVIN);

        if (voice != null) {
            voice.allocate();

            // Adjust voice properties
            voice.setRate(80);   // Reduce speed for clarity
            voice.setPitch(100); // Set a clear pitch
            voice.setVolume(1.0f); // Ensure maximum volume

            // Use Stream API to process each character separately
            IntStream.range(0, text.length())
                    .mapToObj(i -> String.valueOf(text.charAt(i))) // Convert each character to String
                    .filter(ch -> ch.matches("[a-zA-Z0-9]")) // Only allow letters and digits
                    .forEach(ch -> {
                        voice.speak(ch);
                        try {
                            Thread.sleep(500); // Add delay between letters (adjust as needed)
                        } catch (InterruptedException e) {
                            Thread.currentThread().interrupt();
                        }
                    });

            voice.deallocate();
        } else {
            System.err.println("Voice not found: " + VOICENAME_KEVIN);
        }
    }

    public static void main(String[] args) {
        TalkResource talkResource = new TalkResource();
        talkResource.speak("CAPTCHA123"); // Example input
    }
}