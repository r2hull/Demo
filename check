@Component
public class PurgeScheduler {

    @Autowired
    private XyzRepository xyzRepository;

    @Scheduled(cron = "0 0 2 * * ?") // Every day at 2 AM
    public void purgeOldData() {
        LocalDateTime oneWeekAgo = LocalDateTime.now().minusWeeks(1);
        xyzRepository.deleteOlderThan(oneWeekAgo);
    }
}


@Repository
public interface XyzRepository extends JpaRepository<XyzEntity, Long> {

    @Modifying
    @Transactional
    @Query("DELETE FROM XyzEntity x WHERE x.createdAt <= :cutoffDate")
    void deleteOlderThan(@Param("cutoffDate") LocalDateTime cutoffDate);
}