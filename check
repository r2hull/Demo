The bulk refund process starts when a request is received with a unique bulk ID. The system fetches the corresponding bulk booking details from the database and marks the booking as in-process. It then reads the refund data from a CSV file stored in a cloud location like S3. Before processing, the system validates the CSV headers to ensure they match the expected format for the given merchant. If the headers are invalid, the booking is marked as failed with an appropriate error message and processing stops. If the headers are valid, each row of the CSV is read and converted into refund details which are saved in the database. Valid rows are then pushed to a Kafka topic for asynchronous processing. If none of the rows are valid, the booking is marked as processed with zero valid records and a remark is added. For each row pushed to Kafka, a consumer picks it up, processes the refund by calling the refund service, and updates the row status as success or failed based on the outcome. After each row is processed, the system checks if all rows in the bulk file are completed and then updates the final status of the bulk booking accordingly.

